<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>PlanAll – AI 운동 스케줄러</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin:0; background:#f9f9f9; }
    .container { max-width:800px; margin:40px auto; background:#fff; padding:30px 20px; border-radius:16px; box-shadow:0 2px 16px rgba(0,0,0,0.05);}
    h1 { color: #ff6b6b; }
    .hidden { display: none !important; }
    .btn { padding:8px 18px; border-radius:5px; border:none; background:#ff6b6b; color:#fff; cursor:pointer; }
    table { border-collapse:collapse; width:100%; margin-top:18px; }
    th,td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#f3f3f3;}
    .form { max-width:340px; margin:auto;}
    input { width:100%; padding:9px; margin-bottom:12px; border:1px solid #ccc; border-radius:5px; }
  </style>
</head>
<body>
<div class="container">
  <!-- 로그인/회원가입 영역 -->
  <div id="login">
    <div class="form">
      <h2>PlanAll 로그인</h2>
      <input type="text" id="username" placeholder="이메일" />
      <input type="password" id="password" placeholder="비밀번호" />
      <button type="button" class="btn" onclick="login()">로그인</button>
      <button type="button" class="btn" style="background:#888;margin-top:7px" onclick="showSignupForm()">회원가입</button>
      <p id="error" style="color:red; text-align:center; display:none;">아이디 또는 비밀번호가 올바르지 않습니다.</p>
    </div>
  </div>
  <div id="signup" class="hidden">
    <div class="form">
      <h2>회원가입</h2>
      <input type="text" id="signupEmail" placeholder="이메일" />
      <input type="password" id="signupPw" placeholder="비밀번호(8자 이상, 영문+숫자)" />
      <input type="password" id="signupPw2" placeholder="비밀번호 확인" />
      <button type="button" class="btn" onclick="signup()">가입하기</button>
      <button type="button" class="btn" style="background:#888;" onclick="showLoginForm()">로그인으로</button>
      <p id="signupError" style="color:red; text-align:center; display:none;"></p>
    </div>
  </div>

  <!-- 메인 콘텐츠 -->
  <div id="mainContent" class="hidden">
    <h1>PlanAll</h1>
    <button class="btn" style="float:right;" onclick="logout()">로그아웃</button>
    <h2>건강 데이터 샘플(CSV 업로드)</h2>
    <input type="file" id="csvFile" accept=".csv" style="margin-bottom:18px;" />
    <table id="csvTable"></table>
    <hr style="margin:30px 0;">
    <h2>팀 프로젝트 소개</h2>
    <p>PlanAll은 AI기반으로 신체 데이터(심박수, 수면, 스트레스 등)와 선호를 분석하여 최적의 운동 루틴을 추천/기록하는 시스템입니다.</p>
  </div>
</div>
<script>
let users = [
  { username: 'user1@naver.com', password: 'Pass1234' },
  { username: 'user2@gmail.com', password: 'Test5678' }
];
function saveUsers(){ localStorage.setItem('users', JSON.stringify(users)); }
function loadUsers(){ const u = localStorage.getItem('users'); if(u) users = JSON.parse(u);}
loadUsers();

function validateEmail(email){ return /^[\\w-.]+@[\\w-]+\\.[a-zA-Z]{2,}$/.test(email);}
function validatePw(pw){ return /^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$/.test(pw);}
function showSignupForm(){ document.getElementById('login').classList.add('hidden'); document.getElementById('signup').classList.remove('hidden'); document.getElementById('signupError').style.display = 'none'; }
function showLoginForm(){ document.getElementById('signup').classList.add('hidden'); document.getElementById('login').classList.remove('hidden'); document.getElementById('error').style.display = 'none'; }
function signup(){
  const email = document.getElementById('signupEmail').value.trim();
  const pw = document.getElementById('signupPw').value;
  const pw2 = document.getElementById('signupPw2').value;
  const err = document.getElementById('signupError');
  if(!validateEmail(email)){ err.textContent='올바른 이메일 형식이 아닙니다.'; err.style.display='block'; return;}
  if(!validatePw(pw)){ err.textContent='비밀번호는 8자 이상, 영어+숫자 조합이어야 합니다.'; err.style.display='block'; return;}
  if(pw!==pw2){ err.textContent='비밀번호가 일치하지 않습니다.'; err.style.display='block'; return;}
  if(users.some(user=>user.username===email)){ err.textContent='이미 등록된 이메일입니다.'; err.style.display='block'; return;}
  users.push({ username: email, password: pw }); saveUsers();
  err.style.display = 'none'; localStorage.setItem('loggedIn', 'true');
  // health_dataset.json에서 랜덤값으로 새 파일 생성
  fetch('health_dataset.json').then(res=>res.json()).then(dataset=>{
    const rand = dataset[Math.floor(Math.random()*dataset.length)];
    const userHealth = { sleepHours: rand.sleepHours, heartRate: rand.heartRate, stressLevel: rand.stressLevel };
    const blob = new Blob([JSON.stringify(userHealth,null,2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = email + '.json'; a.click();
    showMain();
  });
}
function login(){
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  const valid = users.some(user=>user.username===u && user.password===p);
  if(valid){ localStorage.setItem('loggedIn','true'); document.getElementById('error').style.display='none'; showMain(); }
  else document.getElementById('error').style.display='block';
}
function showMain(){ document.getElementById('login').classList.add('hidden'); document.getElementById('signup').classList.add('hidden'); document.getElementById('mainContent').classList.remove('hidden'); }
function logout(){ localStorage.removeItem('loggedIn'); location.reload(); }
window.onload = ()=>{ if(localStorage.getItem('loggedIn')==='true') showMain(); };
// CSV 표 업로드
function parseCSV(text){ const rows=text.trim().split('\\n'); return rows.map(row=>row.split(',')); }
document.getElementById('csvFile').addEventListener('change',function(e){
  const file=e.target.files[0]; const reader=new FileReader();
  reader.onload=function(evt){
    const data=parseCSV(evt.target.result);
    const table=document.getElementById('csvTable'); table.innerHTML='';
    data.forEach((row,i)=>{
      const tr=document.createElement('tr');
      row.forEach(cell=>{
        const td=document.createElement(i==0?'th':'td'); td.textContent=cell; tr.appendChild(td);
      }); table.appendChild(tr);
    });
  }; if(file) reader.readAsText(file,'utf-8');
});
</script>
</body>
</html>
